#
# Copyright 2007-2016, Kaazing Corporation. All rights reserved.
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
# http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
#

#
# client
#

connect tcp://localhost:8110
connected

write "GET /image HTTP/1.1\r\n"
write "Host: localhost:8110\r\n"
write "Connection: close\r\n"
write "Upgrade-Insecure-Requests: 1\r\n"
write "User-Agent: Mozilla/5.0 (Windows NT 6.3; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/51.0.2704.103 Safari/537.36\r\n"
write "Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8\r\n"
write "Accept-Encoding: gzip, deflate, sdch\r\n"
write "Accept-Language: en-US,en;q=0.8\r\n"
write "\r\n"

read "HTTP/1.1 200 OK\r\n"
read "Access-Control-Allow-Credentials: true\r\n"
read "Access-Control-Allow-Origin: *\r\n"
read "Content-Length: 455\r\n"
read "Content-Type: image/webp\r\n"
read "Date: Fri, 01 Jul 2016 12:53:34 GMT\r\n"
read "Server: nginx\r\n"
read "\r\n"

read "RIFF@)"
read [0x00 0x00]
read "WEBPVP8X\n"
read [0x00 0x00 0x00 0x04 0x00 0x00 0x00 0x11 0x01 0x00 0x6E 0x01 0x00]
read "VP8 X%"
read [0x00 0x00 0x92 0x9F 0x00 0x9D 0x01 0x2A 0x12 0x01 0x6F 0x01 0x3E 0x31 0x16 0x89 0x43 0x82 0x43 0x13 0xBC 0xC0 0x00 0x60]
read [0x96 0x96 0xEF 0xC7 0xCC 0x24 0x0D 0x67 0xF4 0xFF 0x50 0x4F 0x02 0xDC 0x3B 0x41 0x38 0x8F 0xFB 0xCF 0xE4 0xCF 0xF8 0x0E]
read [0x84 0x0F 0x54 0x0F 0xB8 0x0E 0xD0 0x1E 0x60 0x3F 0x52 0x7F 0xC4 0x7A 0xA4 0xFE 0xA0 0x7B 0x80 0xFC 0x40 0xF7 0x00 0xFD]
read [0x76 0xEB 0x00 0xF4 0x20 0xFD 0x8C 0xF4 0xBE 0xFD 0x8C 0xF8 0x26 0xFD 0x9F 0xF4 0x6F 0xD5 0x5E 0xF1 0x5F 0xF6 0x2F 0xC9]
read [0xFF 0x78 0xDD 0xCD 0xFD 0x67 0xFB 0xBF 0xED 0x0F 0xF6 0xBF 0xFD 0x3E 0x66 0x7E 0x6D 0xFA 0xE7 0xE4 0xD7 0xF6 0x7F 0xFC]
read [0x1F 0xE8 0x7E 0x28 0x33 0x27 0xD8 0xC6 0xA5 0xFF 0x1A 0xFA 0xE3 0xF8 0x2F 0xED 0x9F 0xE1 0xBF 0xDD 0xFF 0x75 0xFD 0xC0]
read [0xF8 0x73 0xFC 0xDF 0x81 0xFF 0x27 0x7F 0x9F 0xFC 0xBE 0xF8 0x05 0xFC 0x67 0xF9 0x3F 0xF8 0x0F 0xEC 0x9F 0xB7 0x1F 0xDD]
read [0x7F 0x71 0xBE 0xA7 0x7E 0x8B 0xFD 0x1F 0xF6 0x2F 0xC3 0x3F 0x18 0x3B 0x4D 0xFE 0xD3 0xD4 0x17 0xDD 0xAF 0xA8 0x7F 0xAB]
read [0xFF 0x1F 0xFB 0xCB 0xFE 0x1F 0xD2 0x5F 0xFB 0x9F 0x43 0xFE 0xC5 0x7F 0xB5 0xFC 0xAE 0xFE 0xF1 0xF6 0x03 0xFC 0xFF 0xFA]
read [0x67 0xF9 0xDF 0xEF 0xFF 0xBA 0x1F 0xE2 0xFF 0xFB 0x7D 0x7D 0xFF 0x0F 0xC0 0xDF 0xF1 0xFF 0xF1 0xFF 0x66 0xFE 0x00 0xBF]
read [0x97 0x7F 0x57 0xFF 0x71 0xFE 0x27 0xFC 0xC7 0xFD 0x7F 0xF4 0x9F 0x4C 0xDF 0xC7 0xFF 0xDB 0xFF 0x19 0xFE 0xA7 0xF6 0xCF]
read [0xDA 0xCF 0xE8 0x7F 0xE2 0x3F 0xEA 0xFF 0x99 0xFF 0x31 0xFB 0x4B 0xF6 0x1F 0xFC 0xCB 0xFA 0xAF 0xFB 0x7F 0xEF 0xDF 0xE7]
read [0xFF 0xF5 0xFF 0x9B 0xFF 0xFF 0xFF 0x7B 0xEE 0xC7 0xD8 0x07 0xED 0xDF 0xFD 0xCF 0x74 0xFF 0xD8 0xAF 0xFD 0x57 0x24 0x7F]
read [0xAC 0xDB 0x08 0x7A 0xBD 0xA8 0xFE 0xC9 0x1E 0x69 0xBD 0x93 0x6E 0x31 0x78 0x78 0xD0 0x18 0x1A 0x8A 0x14 0x27 0xAB 0xED]
read [0x81 0xE2 0x77 0x26 0x5E 0xAE 0xFD 0x94 0x88 0x42 0x7D 0xFD 0xA3 0xAE 0x42 0xFE 0x01 0x7E 0x06 0xD6 0x66 0xE9 0x74 0xD7]
read [0x83 0x66 0xD4 0x75 0x5E 0x85 0x42 0x21 0xDD 0xEA 0xD5 0xEF 0x97 0xBE 0x52 0x56 0x95 0x7C 0x81 0x94 0x8B 0xE2 0xEC 0x27]
read [0xC4 0x9D 0xD5 0x6C 0xEC 0x3D 0x3C 0xF5 0x2F 0x88 0x78 0xE7 0xF3 0x7C 0xBA 0x6A 0x4B 0xC4 0xE2 0x0F 0x22 0xBC 0xEE 0x37]
read [0x36 0x0B 0x89 0x28 0xA7 0x05 0x31 0x59 0xBD]
read "\r\n"

close
closed

#
# server
#

accept tcp://localhost:8080
accepted
connected

read "GET /image HTTP/1.1\r\n"
read /Via: 1.1 kaazing-.+/ "\r\n"
read "User-Agent: Mozilla/5.0 (Windows NT 6.3; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/51.0.2704.103 Safari/537.36\r\n"
read "Upgrade-Insecure-Requests: 1\r\n"
read "Host: localhost:8080\r\n"
read "Connection: close\r\n"
read "Accept-Language: en-US\r\n"
read "Accept-Language: en;q=0.8\r\n"
read "Accept-Encoding: gzip\r\n"
read "Accept-Encoding: deflate\r\n"
read "Accept-Encoding: sdch\r\n"
read "Accept: text/html\r\n"
read "Accept: application/xhtml+xml\r\n"
read "Accept: application/xml;q=0.9\r\n"
read "Accept: image/webp\r\n"
read "Accept: */*;q=0.8\r\n"

read "\r\n"

write "HTTP/1.1 200 OK\r\n"
write "Access-Control-Allow-Credentials: true\r\n"
write "Access-Control-Allow-Origin: *\r\n"
write "Content-Length: 455\r\n"
write "Content-Type: image/webp\r\n"
write "Date: Fri, 01 Jul 2016 12:53:34 GMT\r\n"
write "Server: nginx\r\n"
write "\r\n"

write "RIFF@)"
write [0x00 0x00]
write "WEBPVP8X\n"
write [0x00 0x00 0x00 0x04 0x00 0x00 0x00 0x11 0x01 0x00 0x6E 0x01 0x00]
write "VP8 X%"
write [0x00 0x00 0x92 0x9F 0x00 0x9D 0x01 0x2A 0x12 0x01 0x6F 0x01 0x3E 0x31 0x16 0x89 0x43 0x82 0x43 0x13 0xBC 0xC0 0x00 0x60]
write [0x96 0x96 0xEF 0xC7 0xCC 0x24 0x0D 0x67 0xF4 0xFF 0x50 0x4F 0x02 0xDC 0x3B 0x41 0x38 0x8F 0xFB 0xCF 0xE4 0xCF 0xF8 0x0E]
write [0x84 0x0F 0x54 0x0F 0xB8 0x0E 0xD0 0x1E 0x60 0x3F 0x52 0x7F 0xC4 0x7A 0xA4 0xFE 0xA0 0x7B 0x80 0xFC 0x40 0xF7 0x00 0xFD]
write [0x76 0xEB 0x00 0xF4 0x20 0xFD 0x8C 0xF4 0xBE 0xFD 0x8C 0xF8 0x26 0xFD 0x9F 0xF4 0x6F 0xD5 0x5E 0xF1 0x5F 0xF6 0x2F 0xC9]
write [0xFF 0x78 0xDD 0xCD 0xFD 0x67 0xFB 0xBF 0xED 0x0F 0xF6 0xBF 0xFD 0x3E 0x66 0x7E 0x6D 0xFA 0xE7 0xE4 0xD7 0xF6 0x7F 0xFC]
write [0x1F 0xE8 0x7E 0x28 0x33 0x27 0xD8 0xC6 0xA5 0xFF 0x1A 0xFA 0xE3 0xF8 0x2F 0xED 0x9F 0xE1 0xBF 0xDD 0xFF 0x75 0xFD 0xC0]
write [0xF8 0x73 0xFC 0xDF 0x81 0xFF 0x27 0x7F 0x9F 0xFC 0xBE 0xF8 0x05 0xFC 0x67 0xF9 0x3F 0xF8 0x0F 0xEC 0x9F 0xB7 0x1F 0xDD]
write [0x7F 0x71 0xBE 0xA7 0x7E 0x8B 0xFD 0x1F 0xF6 0x2F 0xC3 0x3F 0x18 0x3B 0x4D 0xFE 0xD3 0xD4 0x17 0xDD 0xAF 0xA8 0x7F 0xAB]
write [0xFF 0x1F 0xFB 0xCB 0xFE 0x1F 0xD2 0x5F 0xFB 0x9F 0x43 0xFE 0xC5 0x7F 0xB5 0xFC 0xAE 0xFE 0xF1 0xF6 0x03 0xFC 0xFF 0xFA]
write [0x67 0xF9 0xDF 0xEF 0xFF 0xBA 0x1F 0xE2 0xFF 0xFB 0x7D 0x7D 0xFF 0x0F 0xC0 0xDF 0xF1 0xFF 0xF1 0xFF 0x66 0xFE 0x00 0xBF]
write [0x97 0x7F 0x57 0xFF 0x71 0xFE 0x27 0xFC 0xC7 0xFD 0x7F 0xF4 0x9F 0x4C 0xDF 0xC7 0xFF 0xDB 0xFF 0x19 0xFE 0xA7 0xF6 0xCF]
write [0xDA 0xCF 0xE8 0x7F 0xE2 0x3F 0xEA 0xFF 0x99 0xFF 0x31 0xFB 0x4B 0xF6 0x1F 0xFC 0xCB 0xFA 0xAF 0xFB 0x7F 0xEF 0xDF 0xE7]
write [0xFF 0xF5 0xFF 0x9B 0xFF 0xFF 0xFF 0x7B 0xEE 0xC7 0xD8 0x07 0xED 0xDF 0xFD 0xCF 0x74 0xFF 0xD8 0xAF 0xFD 0x57 0x24 0x7F]
write [0xAC 0xDB 0x08 0x7A 0xBD 0xA8 0xFE 0xC9 0x1E 0x69 0xBD 0x93 0x6E 0x31 0x78 0x78 0xD0 0x18 0x1A 0x8A 0x14 0x27 0xAB 0xED]
write [0x81 0xE2 0x77 0x26 0x5E 0xAE 0xFD 0x94 0x88 0x42 0x7D 0xFD 0xA3 0xAE 0x42 0xFE 0x01 0x7E 0x06 0xD6 0x66 0xE9 0x74 0xD7]
write [0x83 0x66 0xD4 0x75 0x5E 0x85 0x42 0x21 0xDD 0xEA 0xD5 0xEF 0x97 0xBE 0x52 0x56 0x95 0x7C 0x81 0x94 0x8B 0xE2 0xEC 0x27]
write [0xC4 0x9D 0xD5 0x6C 0xEC 0x3D 0x3C 0xF5 0x2F 0x88 0x78 0xE7 0xF3 0x7C 0xBA 0x6A 0x4B 0xC4 0xE2 0x0F 0x22 0xBC 0xEE 0x37]
write [0x36 0x0B 0x89 0x28 0xA7 0x05 0x31 0x59 0xBD]
write "\r\n"

# gateway(sender) closes the connection
closed
