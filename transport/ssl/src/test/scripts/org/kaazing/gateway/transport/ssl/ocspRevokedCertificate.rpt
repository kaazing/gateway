#
# Copyright 2007-2016, Kaazing Corporation. All rights reserved.
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
# http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
#

# OCSP Responder which sends a response that the certificate is revoked
# Gateway(localhost:9558) <---> robot/ocsp responder (localhost:8192)
#
# The following traffic is captured using openssl
# openssl ocsp -text -index revoked.txt -CA democa.crt -rsigner democa.crt -rkey democa.pem -port 8192
#
# revoked.txt (22933D8C is serial number of client certificate)
# R\t060920165425Z\t050315152021Z\t22933D8C\tunknown\t/CN=localhost/OU=Engineering/O=Kaazing Corporation/L=Mountain View/S=California/C=US

accept tcp://localhost:8192
accepted
connected

read "POST / HTTP/1.1\r\n"
read "Content-type: application/ocsp-request\r\n"
read /User-Agent: .*/ "\r\n"
read "Host: localhost:8192\r\n"
read /Accept: .*/ "\r\n"
read "Connection: keep-alive\r\n"
read "Content-Length: 71\r\n"
read "\r\n"

# OCSP Request Data:
#    Version: 1 (0x0)
#    Requestor List:
#        Certificate ID:
#          Hash Algorithm: sha1
#          Issuer Name Hash: E03A4740A2FAAC4C677EB97F4CC5D9916E9755F3
#          Issuer Key Hash: DB5705061D8F0318842C5FE3F337A77C407B2FC9
#          Serial Number: 22933D8C

read [0x30 0x45 0x30 0x43 0x30 0x41 0x30 0x3f 0x30 0x3d 0x30 0x09 0x06 0x05 0x2b 0x0e]
read [0x03 0x02 0x1a 0x05 0x00 0x04 0x14 0xe0 0x3a 0x47 0x40 0xa2 0xfa 0xac 0x4c 0x67]
read [0x7e 0xb9 0x7f 0x4c 0xc5 0xd9 0x91 0x6e 0x97 0x55 0xf3 0x04 0x14 0xdb 0x57 0x05]
read [0x06 0x1d 0x8f 0x03 0x18 0x84 0x2c 0x5f 0xe3 0xf3 0x37 0xa7 0x7c 0x40 0x7b 0x2f]
read [0xc9 0x02 0x04 0x22 0x93 0x3d 0x8c]

write "HTTP/1.0 200 OK\r\n"
write "Content-type: application/ocsp-response\r\n"
write "Content-Length: 589\r\n"
write "\r\n"

# OCSP Response Data:
#    OCSP Response Status: successful (0x0)
#    Response Type: Basic OCSP Response
#    Version: 1 (0x0)
#    Responder Id: CN = Kaazing Development/emailAddress=support@kaazing.com, OU = Development, O = Kaazing Corporation, ST = California, C = US
#    Produced At: Nov 26 19:58:02 2014 GMT
#    Responses:
#    Certificate ID:
#      Hash Algorithm: sha1
#      Issuer Name Hash: E03A4740A2FAAC4C677EB97F4CC5D9916E9755F3
#      Issuer Key Hash: DB5705061D8F0318842C5FE3F337A77C407B2FC9
#      Serial Number: 22933D8C
#    Cert Status: revoked
#    Revocation Time: Mar 15 15:20:21 2005 GMT
#    This Update: Nov 26 19:58:02 2014 GMT
#
#    Signature Algorithm: sha1WithRSAEncryption

write [0x30 0x82 0x02 0x49 0x0a 0x01 0x00 0xa0 0x82 0x02 0x42 0x30 0x82 0x02 0x3e]
write [0x06 0x09 0x2b 0x06 0x01 0x05 0x05 0x07 0x30 0x01 0x01 0x04 0x82 0x02 0x2f 0x30]
write [0x82 0x02 0x2b 0x30 0x82 0x01 0x13 0xa1 0x81 0x98 0x30 0x81 0x95 0x31 0x3d 0x30]
write [0x3b 0x06 0x03 0x55 0x04 0x03 0x0c 0x34 0x4b 0x61 0x61 0x7a 0x69 0x6e 0x67 0x20]
write [0x44 0x65 0x76 0x65 0x6c 0x6f 0x70 0x6d 0x65 0x6e 0x74 0x2f 0x65 0x6d 0x61 0x69]
write [0x6c 0x41 0x64 0x64 0x72 0x65 0x73 0x73 0x3d 0x73 0x75 0x70 0x70 0x6f 0x72 0x74]
write [0x40 0x6b 0x61 0x61 0x7a 0x69 0x6e 0x67 0x2e 0x63 0x6f 0x6d 0x31 0x14 0x30 0x12]
write [0x06 0x03 0x55 0x04 0x0b 0x13 0x0b 0x44 0x65 0x76 0x65 0x6c 0x6f 0x70 0x6d 0x65]
write [0x6e 0x74 0x31 0x1c 0x30 0x1a 0x06 0x03 0x55 0x04 0x0a 0x13 0x13 0x4b 0x61 0x61]
write [0x7a 0x69 0x6e 0x67 0x20 0x43 0x6f 0x72 0x70 0x6f 0x72 0x61 0x74 0x69 0x6f 0x6e]
write [0x31 0x13 0x30 0x11 0x06 0x03 0x55 0x04 0x08 0x13 0x0a 0x43 0x61 0x6c 0x69 0x66]
write [0x6f 0x72 0x6e 0x69 0x61 0x31 0x0b 0x30 0x09 0x06 0x03 0x55 0x04 0x06 0x13 0x02]
write [0x55 0x53 0x18 0x0f 0x32 0x30 0x31 0x34 0x31 0x31 0x32 0x36 0x31 0x39 0x35 0x38]
write [0x30 0x32 0x5a 0x30 0x65 0x30 0x63 0x30 0x3d 0x30 0x09 0x06 0x05 0x2b 0x0e 0x03]
write [0x02 0x1a 0x05 0x00 0x04 0x14 0xe0 0x3a 0x47 0x40 0xa2 0xfa 0xac 0x4c 0x67 0x7e]
write [0xb9 0x7f 0x4c 0xc5 0xd9 0x91 0x6e 0x97 0x55 0xf3 0x04 0x14 0xdb 0x57 0x05 0x06]
write [0x1d 0x8f 0x03 0x18 0x84 0x2c 0x5f 0xe3 0xf3 0x37 0xa7 0x7c 0x40 0x7b 0x2f 0xc9]
write [0x02 0x04 0x22 0x93 0x3d 0x8c 0xa1 0x11 0x18 0x0f 0x32 0x30 0x30 0x35 0x30 0x33]
write [0x31 0x35 0x31 0x35 0x32 0x30 0x32 0x31 0x5a 0x18 0x0f 0x32 0x30 0x31 0x34 0x31]
write [0x31 0x32 0x36 0x31 0x39 0x35 0x38 0x30 0x32 0x5a 0x30 0x0d 0x06 0x09 0x2a 0x86]
write [0x48 0x86 0xf7 0x0d 0x01 0x01 0x05 0x05 0x00 0x03 0x82 0x01 0x01 0x00 0x4a 0xd0]
write [0x86 0xc7 0x13 0xee 0x0d 0x1d 0x68 0x92 0x93 0x17 0x38 0xd9 0x94 0xdb 0xb4 0x3c]
write [0x0f 0xb6 0xf1 0x61 0x9d 0xa9 0x68 0xa0 0x3b 0x6f 0xbe 0x7e 0x51 0xc3 0x45 0xbe]
write [0xdb 0x54 0x73 0x6d 0x0b 0x65 0xb8 0x29 0x2b 0xbe 0x3a 0x7a 0xae 0x32 0x27 0xa8]
write [0xed 0x2b 0x1b 0x5a 0x23 0x95 0x79 0xfc 0xe7 0x0a 0x51 0x57 0xe9 0x8f 0x18 0x49]
write [0xae 0x59 0xa7 0x5e 0x61 0x8e 0x10 0xf3 0x6c 0xbf 0xb4 0x1e 0x00 0x5a 0x95 0x1a]
write [0xcc 0xb5 0x5a 0x83 0x69 0xbf 0x3d 0xb2 0x02 0x71 0xa5 0xec 0x75 0xe2 0x0a 0x40]
write [0xa9 0xb9 0x62 0x4b 0x83 0x9f 0x33 0x7e 0x83 0xb5 0x93 0x64 0x41 0xfd 0xa9 0x4c]
write [0x0f 0x04 0x96 0x7d 0xc1 0x93 0x42 0x6e 0x85 0x87 0xb6 0x4e 0x12 0x12 0x47 0xdd]
write [0x6c 0x9f 0xa7 0xfc 0xe0 0xc8 0x0f 0x2c 0xd5 0x60 0x13 0x31 0xb3 0x4f 0x8e 0x45]
write [0x2e 0x04 0xd5 0xe8 0x58 0x93 0x9b 0xc1 0xf2 0xb5 0xa3 0xd1 0x08 0xc7 0xb3 0xde]
write [0x56 0x63 0xef 0xc4 0x80 0x95 0x78 0x4b 0x6d 0xe0 0x08 0xc1 0x19 0x5e 0x24 0x35]
write [0x28 0xac 0xb3 0x80 0x4c 0x8c 0x74 0xd4 0x6a 0x12 0x38 0xa6 0x04 0xe5 0xf5 0x98]
write [0x9e 0xf6 0x20 0x3e 0xe2 0x7e 0x2d 0xbf 0x78 0x88 0xbc 0x31 0x7f 0x73 0x7f 0x8a]
write [0xd4 0xb4 0xc3 0x1a 0x61 0x45 0x5d 0x7c 0xda 0x93 0x2d 0x1e 0xab 0x3d 0x09 0xa5]
write [0x67 0xe8 0xb8 0xcb 0xea 0x5a 0xef 0x8b 0xa7 0x75 0xdc 0xfd 0xe2 0x02 0x49 0x4d]
write [0x22 0xdb 0x42 0xbc 0x88 0x15 0xc2 0xb3 0xa5 0x01 0x7b 0x1a 0x58 0x4d]

closed
